!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([function(e,t){e.exports=pixi.js},function(e,t){e.exports=spark-md5},function(e,t,s){"use strict";s.r(t);var r=s(0),i=s(1),n=s.n(i);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{constructor(e,t,s){wx.cloud.init({env:e}),this.cloudPath=t,this.localPath=wx.env.USER_DATA_PATH,this.entryFileName=s,this.fs=wx.getFileSystemManager(),this.resources=[]}async _syncLocalFile(e,t){const s=this.localPath+"/"+e,r=this.cloudPath+"/"+e;let i=!1;try{this.fs.accessSync(s)}catch(e){i=!0}if(i||((new n.a.ArrayBuffer).append(this.fs.readFileSync(s)).end(!1)===t?i=!1:(this.fs.unlinkSync(s),i=!0)),i){const t=e.split("/").slice(0,-1);let i=this.localPath+"/";for(const e of t){i+="/"+e;try{this.fs.accessSync(i)}catch(e){this.fs.mkdirSync(i)}}await wx.cloud.downloadFile({fileID:r}).then(e=>{this.fs.saveFileSync(e.tempFilePath,s)}).catch(console.error)}}sync(e){"function"==typeof onComplete&&(this.onSyncComplete=e),wx.cloud.downloadFile({fileID:this.cloudPath+"/"+this.entryFileName,success:e=>{this.fs.saveFile({tempFilePath:e.tempFilePath,filePath:this.localPath+"/"+this.entryFileName,success:e=>{this.fs.readFile({filePath:e.savedFilePath,encoding:"utf-8",success:async e=>{this.assetList=JSON.parse(e.data);let t=0;const s=this.assetList.length;for(const e of this.assetList)await this._syncLocalFile(e.filename,e.md5),"function"==typeof this.onSyncProgress&&this.onSyncProgress(e.filename,++t/s);"function"==typeof this.onSyncComplete&&this.onSyncComplete()},fail:console.error})},fail:console.error})},fail:console.error})}addTexture(e,t){return this.resources.push({id:e.trim().length>0?e.trim():t.trim(),file:t.trim(),type:a.RES_TYPE_TEXTURE}),this}addSpriteSheet(e,t){return this.resources.push({id:e,file:t.trim(),type:a.RES_TYPE_SPRITE_SHEET}),this}addFont(e,t){return this.resources.push({id:e,file:t.trim(),type:a.RES_TYPE_FONT}),this}_getFilePath(e){let t=e;try{this.fs.accessSync(t)}catch(s){t=this.localPath+"/"+e}try{this.fs.accessSync(t)}catch(t){return"function"==typeof this.onLoadError&&this.onLoadError(e,"resource file does not found"),!1}return t}async _loadBaseTexture(e){const t=this._getFilePath(e);return!!t&&new Promise(e=>{const s=wx.createImage();s.src=t,s.onload=(()=>e(new r.BaseTexture(s)))})}async loadTexture(e,t){const s=await this._loadBaseTexture(t);return!!s&&((new r.Texture).addToCache(s,e),!0)}async loadSpritesheet(e,t){const s=this._getFilePath(e),i=this._loadBaseTexture(t);return!(!s||!i)&&await new Promise(e=>{new r.Spritesheet(i,JSON.parse(this.fs.readFileSync(s,"utf-8"))).parse(e)})}async load(e){"function"==typeof e&&(this.onLoadComplete=e);const t=this.resources.length;let s=0;for(let e=0;e<this.resources.length;e++){const r=this.resources[e];r.type===a.RES_TYPE_TEXTURE?await this.loadTexture(r.id,r.url):r.type===a.RES_TYPE_SPRITE_SHEET?await this.loadSpritesheet(r.id,r.url):r.type===a.RES_TYPE_FONT&&await this.loadFont(r.id,r.url),"function"==typeof this.onLoadProgress&&this.onLoadProgress(r,++s/t)}"function"==typeof this.onLoadComplete&&this.onLoadComplete()}}o(a,"RES_TYPE_TEXTURE",0),o(a,"RES_TYPE_SPRITE_SHEET",1),o(a,"RES_TYPE_FONT",2);t.default=a}]);
//# sourceMappingURL=weapp-pixi-loader.js.map